<%- include('partials/header') %>
<%- include('partials/navbar', { currentPage: 'portfolio' }) %>

<section class="page-header">
    <h1 class="page-title">Our Portfolio</h1>
    <p class="page-subtitle">
        Celebrating moments that matter - explore our recent events
    </p>
</section>

<section class="section">
    <div class="portfolio-grid-full">
        <% if (typeof portfolio !== 'undefined' && portfolio.length > 0) { %>
            <% portfolio.forEach(item => { %>
                <div class="portfolio-card-large" onclick="openPortfolioModal('<%= item._id %>')">
                    <div class="portfolio-image-large" <% if (item.images && item.images.length > 0) { %>style="background-image: url('<%= item.images[0] %>');"<% } %>></div>
                    <div class="portfolio-overlay">
                        <h3 class="portfolio-title"><%= item.eventName %></h3>
                        <p class="portfolio-category"><%= item.location %> · <%= item.footCount || 0 %> Guests</p>
                        <p class="portfolio-desc"><%= item.description || 'A beautiful event celebration' %></p>
                    </div>
                </div>
            <% }); %>
        <% } else { %>
            <p>No portfolio items available at the moment.</p>
        <% } %>
    </div>
</section>

<section class="section section-dark">
    <h2 class="section-title">Our Impact</h2>
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-number"><%= typeof about !== 'undefined' && about && about.journeyStats ? (about.journeyStats.eventsHandled || 0) : 0 %>+</div>
            <div class="stat-label">Events Handled</div>
        </div>
        <div class="stat-card">
            <div class="stat-number"><%= typeof about !== 'undefined' && about && about.journeyStats ? (about.journeyStats.vendors || 0) : 0 %>+</div>
            <div class="stat-label">Trusted Vendors</div>
        </div>
        <div class="stat-card">
            <div class="stat-number"><%= typeof about !== 'undefined' && about && about.journeyStats ? (about.journeyStats.clients || 0) : 0 %>+</div>
            <div class="stat-label">Happy Clients</div>
        </div>
    </div>
</section>

<section class="section">
    <h2 class="section-title">Ready to Create Your Event?</h2>
    <p class="section-subtitle">Let's make your celebration unforgettable</p>
    <div style="text-align: center">
        <button class="btn-cta" onclick="openBookingModal()">
            Start Planning
        </button>
    </div>
</section>

<%- include('partials/footer') %>
<%- include('partials/bookingModal', { services: [] }) %>
<%- include('partials/profileModals') %>

<!-- Portfolio Modal -->
<div id="portfolioModal" class="booking-overlay" style="display: none;">
    <div class="booking-modal">
        <div class="booking-header">
            <button class="booking-close" onclick="closePortfolioModal()">&times;</button>
            <h2 id="portfolioModalTitle">Portfolio Details</h2>
        </div>
        <div class="booking-form-container">
            <div id="portfolioModalContent"></div>
        </div>
    </div>
</div>

<script src="/js/script.js"></script>
<script>
    const portfolioData = <%- JSON.stringify(portfolio || []) %>;
    let currentPortfolioImageIndex = 0;
    
    function openPortfolioModal(itemId) {
        const item = portfolioData.find(p => p._id === itemId);
        if (!item) return;
        
        currentPortfolioImageIndex = 0;
        document.getElementById('portfolioModalTitle').textContent = item.eventName;
        
        let imageHtml = '';
        if (item.images && item.images.length > 0) {
            imageHtml = `
                <div style="position: relative; margin-bottom: 20px;">
                    <div id="portfolioModalImage" style="width: 100%; height: 400px; background-image: url('${item.images[0]}'); background-size: contain; background-position: center; background-repeat: no-repeat; background-color: #f5f5f5; border-radius: 8px;"></div>
                    ${item.images.length > 1 ? `
                        <button onclick="prevPortfolioImage(${itemId})" style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); background: rgba(84,110,106,0.8); color: white; border: none; padding: 10px 15px; border-radius: 4px; cursor: pointer; font-size: 18px;">‹</button>
                        <button onclick="nextPortfolioImage(${itemId})" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: rgba(84,110,106,0.8); color: white; border: none; padding: 10px 15px; border-radius: 4px; cursor: pointer; font-size: 18px;">›</button>
                        <div style="position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.6); color: white; padding: 5px 15px; border-radius: 20px; font-size: 12px;">
                            <span id="portfolioImageCounter">1 / ${item.images.length}</span>
                        </div>
                    ` : ''}
                </div>
            `;
        }
        
        document.getElementById('portfolioModalContent').innerHTML = `
            ${imageHtml}
            <p><strong>Location:</strong> ${item.location}</p>
            ${item.timing ? `<p><strong>Timing:</strong> ${item.timing}</p>` : ''}
            ${item.footCount ? `<p><strong>Guests:</strong> ${item.footCount}</p>` : ''}
            ${item.description ? `<p><strong>Description:</strong></p><p>${item.description}</p>` : ''}
            <button class="btn-card" onclick="closePortfolioModal(); openBookingModal();" style="margin-top: 20px;">
                Book Similar Event
            </button>
        `;
        
        // Store current portfolio item for image navigation
        window.currentPortfolioItem = item;
        document.getElementById('portfolioModal').style.display = 'flex';
        document.body.style.overflow = 'hidden';
    }
    
    function closePortfolioModal() {
        document.getElementById('portfolioModal').style.display = 'none';
        document.body.style.overflow = 'auto';
        window.currentPortfolioItem = null;
    }
    
    function nextPortfolioImage(itemId) {
        if (!window.currentPortfolioItem || !window.currentPortfolioItem.images) return;
        currentPortfolioImageIndex = (currentPortfolioImageIndex + 1) % window.currentPortfolioItem.images.length;
        updatePortfolioImage();
    }
    
    function prevPortfolioImage(itemId) {
        if (!window.currentPortfolioItem || !window.currentPortfolioItem.images) return;
        currentPortfolioImageIndex = (currentPortfolioImageIndex - 1 + window.currentPortfolioItem.images.length) % window.currentPortfolioItem.images.length;
        updatePortfolioImage();
    }
    
    function updatePortfolioImage() {
        if (!window.currentPortfolioItem) return;
        const img = document.getElementById('portfolioModalImage');
        const counter = document.getElementById('portfolioImageCounter');
        if (img && window.currentPortfolioItem.images[currentPortfolioImageIndex]) {
            img.style.backgroundImage = `url('${window.currentPortfolioItem.images[currentPortfolioImageIndex]}')`;
            if (counter) {
                counter.textContent = `${currentPortfolioImageIndex + 1} / ${window.currentPortfolioItem.images.length}`;
            }
        }
    }
</script>
</body>
</html>

